name: Create Bundle

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  create-bundle:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - name: Install dependencies
      run: npm ci
    - name: Create directories
      run: |
        mkdir -p src/helpers
        mkdir -p src/core
        mkdir -p scripts
    - name: Create bundle script if not exists
      run: |
        if [ ! -f scripts/create-bundle.js ]; then
          echo "Creating bundle script"
          cat > scripts/create-bundle.js << 'EOF'
          /**
           * Simple script to create a bundle
           */
          const fs = require('fs');
          const path = require('path');

          // Create dist directory if it doesn't exist
          const distDir = path.join(process.cwd(), 'dist');
          if (!fs.existsSync(distDir)) {
            fs.mkdirSync(distDir, { recursive: true });
          }

          // Create a simple bundle file
          const bundleContent = `
          /**
           * Playwright Framework Bundle
           * Generated: ${new Date().toISOString()}
           */
          module.exports = {
            version: '1.0.0',
            name: 'playwright-framework',
            description: 'Playwright Test Framework Bundle'
          };
          `;

          // Write the bundle file
          fs.writeFileSync(path.join(distDir, 'bundle.js'), bundleContent);

          console.log('Bundle created successfully!');
          EOF
        fi
    - name: Create bundle
      run: node scripts/create-bundle.js
    - uses: actions/upload-artifact@v3
      with:
        name: playwright-framework-bundle
        path: dist/
        retention-days: 30